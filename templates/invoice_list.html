{% extends 'base.html' %}
{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="text-primary mb-0">Invoice Registry</h2>
            <p class="text-muted small">Viewing records for: <span class="fw-bold text-dark">{{ display_label if display_label else now.strftime('%B %Y') }}</span></p>
        </div>
        
        <div class="d-flex gap-3 align-items-center">
            <form class="d-flex gap-2 align-items-center" method="GET" action="{{ url_for('edit_list') }}">
                <input type="number" name="day" class="form-control form-control-sm" 
                       placeholder="DD" style="width: 60px;" value="{{ current_filters.day or '' }}">
                
                <select name="month" class="form-select form-select-sm" style="width: 120px;">
                    <option value="">Month...</option>
                    {% for m in range(1, 13) %}
                    <option value="{{ m }}" {% if current_filters.month == m %}selected{% endif %}>
                        {{ ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][m-1] }}
                    </option>
                    {% endfor %}
                </select>
                
                <input type="number" name="year" class="form-control form-control-sm" 
                       placeholder="YYYY" style="width: 85px;" 
                       value="{{ current_filters.year or now.year }}">
                
                <button type="submit" class="btn btn-sm btn-primary shadow-sm">Filter</button>
                
                {% if current_filters.year or current_filters.month or current_filters.day %}
                <a href="{{ url_for('edit_list') }}" class="btn btn-sm btn-outline-danger">Clear</a>
                {% endif %}
            </form>

            <a href="{{ url_for('create_invoice') }}" class="btn btn-success shadow-sm d-flex align-items-center gap-2">
                <span class="fs-5">+</span> Create Invoice
            </a>
        </div>
    </div>

    <ul class="nav nav-tabs mb-3 border-0" id="invoiceTab" role="tablist">
        <li class="nav-item">
            <button class="nav-link active fw-bold border-0 text-uppercase small" data-bs-toggle="tab" data-bs-target="#all-pane" type="button">All Invoices</button>
        </li>
        <li class="nav-item">
            <button class="nav-link fw-bold border-0 text-uppercase small" data-bs-toggle="tab" data-bs-target="#new-pane" type="button">New Created (Current Month)</button>
        </li>
        <li class="nav-item">
            <button class="nav-link fw-bold border-0 text-uppercase small" data-bs-toggle="tab" data-bs-target="#edit-pane" type="button">Edit (Current Month)</button>
        </li>
    </ul>

    <div class="tab-content" id="invoiceTabContent">
        <div class="tab-pane fade show active" id="all-pane">
            <div class="card shadow-sm border-0 rounded-3 overflow-hidden">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-primary text-white small text-uppercase">
                        <tr>
                            <th class="ps-4">Inv #</th>
                            <th>Customer & Project</th>
                            <th>Date</th>
                            <th>Total Amount</th>
                            <th>Status</th>
                            <th class="text-center">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for inv in all_invoices %}
                        <tr>
                            <td class="ps-4 fw-bold text-dark">{{ inv.invoice_number }}</td>
                            <td>
                                <div class="fw-medium">{{ inv.customer.company_name }}</div>
                                <div class="text-muted extra-small">{{ inv.project.project_name if inv.project else 'General' }}</div>
                            </td>
                            <td>{{ inv.invoice_date.strftime('%d-%m-%Y') if inv.invoice_date }}</td>
                            <td class="fw-bold text-primary">{{ "{:,.2f}".format(inv.total_amount) }}</td>
                            <td><span class="status-badge bg-{{ inv.status|lower|replace(' ', '') if inv.status else 'secondary' }}">{{ inv.status }}</span></td>
                            <td class="text-center"><a href="{{ url_for('edit_form', id=inv.id) }}" class="btn btn-sm btn-outline-primary rounded-pill px-3">View</a></td>
                        </tr>
                        {% else %}
                        <tr><td colspan="6" class="text-center py-5 text-muted">No invoices found for this month.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="mt-3 d-flex justify-content-between align-items-center">
                <span class="small text-muted">Page <strong>{{ page }}</strong> of <strong>{{ total_pages }}</strong></span>
                <nav>
                    <ul class="pagination pagination-sm mb-0">
                        {% if page > 1 %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('edit_list', page=page-1) }}">Previous</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link text-danger fw-bold px-3" href="{{ url_for('edit_list', page=1) }}">Current Month</a>
                        </li>
                        {% endif %}
                        
                        <li class="page-item {{ 'disabled' if page >= total_pages }}">
                            <a class="page-link" href="{{ url_for('edit_list', page=page+1) }}">Next</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

        <div class="tab-pane fade" id="new-pane">
            <div class="card shadow-sm border-0 rounded-3 overflow-hidden">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-success text-white small text-uppercase">
                        <tr>
                            <th class="ps-4">Inv #</th>
                            <th>Customer Name</th>
                            <th>Creation Date</th>
                            <th>Amount</th>
                            <th class="text-center">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for inv in new_invoices %}
                        <tr>
                            <td class="ps-4 fw-bold">{{ inv.invoice_number }}</td>
                            <td>{{ inv.customer.company_name }}</td>
                            <td>{{ inv.invoice_date.strftime('%d %B %Y') if inv.invoice_date }}</td>
                            <td class="fw-bold">{{ "{:,.2f}".format(inv.total_amount) }}</td>
                            <td class="text-center"><span class="badge bg-info">Recently Added</span></td>
                        </tr>
                        {% else %}
                        <tr><td colspan="5" class="text-center py-4 text-muted">No new invoices for {{ now.strftime('%B') }}.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="tab-pane fade" id="edit-pane">
            <div class="card shadow-sm border-0 rounded-3 overflow-hidden">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-dark text-white small text-uppercase">
                        <tr>
                            <th class="ps-4">Inv #</th>
                            <th>Customer</th>
                            <th>Amount</th>
                            <th>Amt Received</th>
                            <th class="text-center">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for inv in edit_invoices %}
                        <tr>
                            <td class="ps-4 fw-bold text-dark">{{ inv.invoice_number }}</td>
                            <td>{{ inv.customer.company_name }}</td>
                            <td class="fw-bold">{{ "{:,.2f}".format(inv.total_amount) }}</td>
                            <td class="text-success fw-bold">{{ "{:,.2f}".format(inv.amount_received or 0) }}</td>
                            <td class="text-center">
                                <a href="{{ url_for('edit_form', id=inv.id) }}" class="btn btn-sm btn-warning rounded-pill px-3 shadow-sm">Edit Details</a>
                            </td>
                        </tr>
                        {% else %}
                        <tr><td colspan="5" class="text-center py-4 text-muted">No editable invoices for this month.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
    .status-badge { padding: 4px 12px; border-radius: 50px; font-size: 11px; font-weight: bold; text-transform: uppercase; }
    .bg-raised { background-color: #e3f2fd; color: #0d47a1; }
    .bg-paid { background-color: #e8f5e9; color: #1b5e20; }
    .bg-draft { background-color: #f5f5f5; color: #616161; }
    .bg-pending { background-color: #fffde7; color: #f57f17; }
    .extra-small { font-size: 0.75rem; }
</style>
{% endblock %}