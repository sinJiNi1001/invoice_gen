{% extends 'base.html' %}
{% block content %}
<div class="card shadow-sm border-0">
    <div class="card-header bg-info text-black fw-bold">
        Edit Invoice: {{ invoice.invoice_number }}
    </div>
    <div class="card-body">
        <form method="POST">
            <div class="row mb-3">
                <div class="col-md-4">
                    <label class="small fw-bold">INVOICE NUMBER</label>
                    <input type="text" name="invoice_number" class="form-control" value="{{ invoice.invoice_number }}" required>
                </div>
                <div class="col-md-4">
                    <label class="small fw-bold">DATE</label>
                    <input type="date" name="invoice_date" class="form-control" value="{{ invoice.invoice_date }}" required>
                </div>
                <div class="col-md-4">
                    <label class="small fw-bold">DUE DATE</label>
                    <input type="date" name="due_date" class="form-control" value="{{ invoice.due_date }}">
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-4">
                    <label class="small fw-bold">CUSTOMER</label>
                    <select name="customer_id" class="form-select">
                        {% for c in customers %}
                        <option value="{{c.id}}" {% if invoice.customer_id == c.id %}selected{% endif %}>{{c.company_name}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="small fw-bold">PROJECT</label>
                    <select name="project_id" class="form-select">
                        {% for p in projects %}
                        <option value="{{p.id}}" {% if invoice.project_id == p.id %}selected{% endif %}>{{p.project_name}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="small fw-bold">STATUS</label>
                    <select name="status" class="form-select border-primary">
                        {% for s in ['Draft','Raised','Unpaid','Partially Paid','Paid','Overdue'] %}
                        <option value="{{s}}" {% if invoice.status == s %}selected{% endif %}>{{s}}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="row mb-4 p-3 bg-light border rounded">
                <div class="col-md-3">
                    <label class="small fw-bold">BASE AMOUNT</label>
                    <input type="number" step="0.01" name="invoice_amount" id="base_amount" class="form-control" value="{{ invoice.total_amount }}"> 
                </div>

                <div class="col-md-3">
                    <label class="small fw-bold">TAX TYPE</label>
                    <select name="tax_type" id="tax_type" class="form-select">
                        <option value="GST" {% if invoice.tax_type == 'GST' %}selected{% endif %}>GST (18%)</option>
                        <option value="IGST" {% if invoice.tax_type == 'IGST' %}selected{% endif %}>IGST (18%)</option>
                        <option value="NONE" {% if invoice.tax_type == 'NONE' %}selected{% endif %}>NONE (0%)</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="small fw-bold">TAX AMOUNT</label>
                    <input type="number" step="0.01" name="tax_amount" id="tax_amount" class="form-control bg-white" value="{{ invoice.tax_amount }}" readonly>
                </div>
                <div class="col-md-3">
                    <label class="small fw-bold">TOTAL AMOUNT</label>
                    <input type="number" step="0.01" name="total_amount" id="total_amount" class="form-control bg-white fw-bold" value="{{ invoice.total_amount }}" readonly>
                </div>
            </div>

            <div class="d-flex justify-content-between">
                <a href="{{ url_for('edit_list') }}" class="btn btn-secondary px-4">Cancel</a>
                <button type="submit" class="btn btn-info px-5 fw-bold">Update Invoice</button>
            </div>
        </form>
    </div>
</div>

<script>
    const baseInput = document.getElementById('base_amount');
    const taxTypeSelect = document.getElementById('tax_type');
    const taxAmountInput = document.getElementById('tax_amount');
    const totalAmountInput = document.getElementById('total_amount');

    function calculateInvoice() 
    {
        const baseValue = parseFloat(baseInput.value) || 0;
        const taxRate = (taxTypeSelect.value === 'NONE') ? 0 : 0.18;
        const tax = baseValue * taxRate;
        taxAmountInput.value = tax.toFixed(2);
        totalAmountInput.value = (baseValue + tax).toFixed(2);
    }

    baseInput.addEventListener('input', calculateInvoice);
    taxTypeSelect.addEventListener('change', calculateInvoice);
</script>
{% endblock %}