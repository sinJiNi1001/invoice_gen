{% extends "base.html" %}
{% block content %}

<div class="container mt-4" style="font-family: 'Calibri', sans-serif;">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-primary mb-0"><i class="fa-solid fa-gauge-high me-2"></i>Admin Dashboard</h2>
        
        <form class="d-flex align-items-center gap-2" method="get">
            <input type="hidden" name="tab" value="{{ tab }}">
            
            {# Invoice Type Filter #}
            {% if tab == 'invoices' %}
            <label class="text-muted fw-bold small ms-3">Type:</label>
            <select name="invoice_type" class="form-select form-select-sm w-auto" onchange="this.form.submit()">
                <option value="all" {% if invoice_type == 'all' %}selected{% endif %}>üîç All</option>
                <option value="project" {% if invoice_type == 'project' %}selected{% endif %}>üìÅ Projects</option>
                <option value="contract" {% if invoice_type == 'contract' %}selected{% endif %}>üìú Contracts</option>
            </select>
            {% endif %}

            <label class="text-muted fw-bold small ms-2">Sort By:</label>
            <select name="sort" class="form-select form-select-sm w-auto" onchange="this.form.submit()">
                {% if tab == 'invoices' %}
                    <option value="newest" {% if sort == 'newest' %}selected{% endif %}>Newest Date</option>
                    <option value="oldest" {% if sort == 'oldest' %}selected{% endif %}>Oldest Date</option>
                    <option value="amount_high" {% if sort == 'amount_high' %}selected{% endif %}>Amount (High to Low)</option>
                    <option value="amount_low" {% if sort == 'amount_low' %}selected{% endif %}>Amount (Low to High)</option>
                {% elif tab == 'contracts' %}
                    <option value="newest" {% if sort == 'newest' %}selected{% endif %}>Start Date (Newest)</option>
                    <option value="oldest" {% if sort == 'oldest' %}selected{% endif %}>Start Date (Oldest)</option>
                    <option value="value_high" {% if sort == 'value_high' %}selected{% endif %}>Value (High to Low)</option>
                    <option value="status" {% if sort == 'status' %}selected{% endif %}>Status</option>
                {% elif tab == 'customers' %}
                    <option value="newest" {% if sort == 'newest' %}selected{% endif %}>Joined (Newest)</option>
                    <option value="oldest" {% if sort == 'oldest' %}selected{% endif %}>Joined (Oldest)</option>
                    <option value="name_asc" {% if sort == 'name_asc' %}selected{% endif %}>Name (A-Z)</option>
                    <option value="name_desc" {% if sort == 'name_desc' %}selected{% endif %}>Name (Z-A)</option>
                {% elif tab == 'projects' %}
                    <option value="newest" {% if sort == 'newest' %}selected{% endif %}>Newest Created</option>
                    <option value="name_asc" {% if sort == 'name_asc' %}selected{% endif %}>Name (A-Z)</option>
                {% elif tab == 'services' %}
                    <option value="name_asc" {% if sort == 'name_asc' %}selected{% endif %}>Name (A-Z)</option>
                    <option value="name_desc" {% if sort == 'name_desc' %}selected{% endif %}>Name (Z-A)</option>
                {% endif %}
            </select>
        </form>
    </div>

    <ul class="nav nav-tabs mb-3">
        <li class="nav-item">
            <a class="nav-link {% if tab == 'invoices' %}active{% endif %}" href="{{ url_for('dashboard', tab='invoices') }}">Invoices</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if tab == 'contracts' %}active{% endif %}" href="{{ url_for('dashboard', tab='contracts') }}">Contracts</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if tab == 'customers' %}active{% endif %}" href="{{ url_for('dashboard', tab='customers') }}">Customers</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if tab == 'projects' %}active{% endif %}" href="{{ url_for('dashboard', tab='projects') }}">Projects</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if tab == 'services' %}active{% endif %}" href="{{ url_for('dashboard', tab='services') }}">Services</a>
        </li>
    </ul>

    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        {% if tab == 'invoices' %}
                        <tr>
                            <th class="ps-3">Invoice #</th>
                            <th>Date</th>
                            <th>Customer</th>
                            <th>Total</th>
                            <th>Status</th>
                        </tr>
                        {% elif tab == 'contracts' %}
                        <tr>
                            <th class="ps-3">Contract Name</th>
                            <th>Customer</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Value</th>
                            <th>Status</th>
                        </tr>
                        {% elif tab == 'customers' %}
                        <tr>
                            <th class="ps-3">Company Name</th>
                            <th>Contact Person</th>
                            <th>Email</th>
                            <th>Country</th>
                            <th>Joined</th>
                        </tr>
                        {% elif tab == 'projects' %}
                        <tr>
                            <th class="ps-3">Project Name</th>
                            <th>Code</th>
                            <th>Status</th>
                        </tr>
                        {% elif tab == 'services' %}
                        <tr>
                            <th class="ps-3">Service Name</th>
                            <th>Description</th>
                        </tr>
                        {% endif %}
                    </thead>
                    <tbody>
                        {% for item in pagination.items %}
                        <tr>
                            {% if tab == 'invoices' %}
                                <td class="ps-3 fw-bold">{{ item.invoice_number }}</td>
                                <td>{{ item.invoice_date.strftime('%d %b %Y') }}</td>
                                <td>{{ item.customer.company_name if item.customer else 'Unknown' }}</td>
                                <td>‚Çπ{{ "{:,.2f}".format(item.total_amount) }}</td>
                                <td>
                                    <span class="badge bg-{{ 'success' if item.status == 'Paid' else 'warning' }}">
                                        {{ item.status }}
                                    </span>
                                </td>
                            {% elif tab == 'contracts' %}
                                <td class="ps-3 fw-bold">{{ item.contract_name }}</td>
                                <td>{{ item.customer.company_name if item.customer else 'Unknown' }}</td>
                                <td>{{ item.start_date.strftime('%d %b %Y') }}</td>
                                <td>{{ item.end_date.strftime('%d %b %Y') }}</td>
                                <td>{{ "{:,.2f}".format(item.total_value) }}</td>
                                <td>
                                    <span class="badge bg-{{ 'success' if item.status == 'Active' else 'secondary' }}">
                                        {{ item.status }}
                                    </span>
                                </td>
                            {% elif tab == 'customers' %}
                                <td class="ps-3 fw-bold">{{ item.company_name }}</td>
                                <td>{{ item.first_name }} {{ item.last_name }}</td>
                                <td>{{ item.email }}</td>
                                <td>{{ item.country }}</td>
                                <td>{{ item.joined_date }}</td>
                            {% elif tab == 'projects' %}
                                <td class="ps-3 fw-bold">{{ item.project_name }}</td>
                                <td>{{ item.project_code }}</td>
                                <td><span class="badge bg-info text-dark">Active</span></td>
                            {% elif tab == 'services' %}
                                <td class="ps-3 fw-bold">{{ item.service_name }}</td>
                                <td class="text-muted small">{{ item.description }}</td>
                            {% endif %}
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="6" class="text-center py-4 text-muted">No records found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="card-footer d-flex justify-content-between align-items-center bg-white border-top-0 py-3">
            <span class="text-muted small">
                Showing {{ ((pagination.page - 1) * pagination.per_page) + 1 }} 
                to {{ ((pagination.page - 1) * pagination.per_page) + pagination.items|length }} 
                of {{ pagination.total }} entries
            </span>
            <nav>
                <ul class="pagination pagination-sm mb-0">
                    <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
                        <a class="page-link" href="{{ url_for('dashboard', tab=tab, page=pagination.prev_num, sort=sort, invoice_type=invoice_type) }}">Previous</a>
                    </li>
                    
                    {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=1) %}
                        {% if page_num %}
                            <li class="page-item {% if page_num == pagination.page %}active{% endif %}">
                                <a class="page-link" href="{{ url_for('dashboard', tab=tab, page=page_num, sort=sort, invoice_type=invoice_type) }}">{{ page_num }}</a>
                            </li>
                        {% else %}
                            <li class="page-item disabled"><span class="page-link">...</span></li>
                        {% endif %}
                    {% endfor %}

                    <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
                        <a class="page-link" href="{{ url_for('dashboard', tab=tab, page=pagination.next_num, sort=sort, invoice_type=invoice_type) }}">Next</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>

{% endblock %}